<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <title>Bank Portal</title>
    <style>
      body{
        height: 1080px;
        background-color: #fff8dc;
      }

      .login{
        margin-left: auto;
        margin-right: auto;
        margin-top: 250px;
        width: 50%;
        border: 1px solid black;
        padding: 100px;
        text-align:center;
        background-color:#871282;
        color:white;
        box-shadow: 5px 5px 5px 5px #888888;
      }
      
      .accountsList{
        margin-top: 100px;
        padding-bottom: 100px;
      }

      .account{
        margin-top: 20px;
      }

      .payment-message{
        margin-top: 20px;
        margin-bottom: 20px;
        background-color: white;
        box-shadow: 5px 5px 5px 5px #888888;
        margin-left: auto;
        margin-right: auto;
        width: 50%
      }

      .transfer{
        padding: 20px;
      }

    </style>
  </head>
  <body>

    <div id='app'>
        <div v-if='!loggedIn'>
          <div class='login'>
            <label for="userID">userID:</label>
            <input type="text" id="userID" name="userID" v-model='userID'><br><br>
            <label for="PIN">PIN:</label>
            <input type="password" id="PIN" name="PIN" v-model='PIN'><br><br>
            <button class="btn btn-primary" v-on:click='login'>Login</button>
          </div>
        </div>
       <div v-if='loggedIn && !selected' class='accountsList'>
         <div class="col d-flex justify-content-center account">
          <button type="button" class="btn btn-info" v-on:click='logout'>Logout</button>
         </div>
        <div v-for="(account, index) in accounts" class="col d-flex justify-content-center account">
          <account @account-select='accountSelect' v-bind:currency="account.currency" v-bind:current_status="account.currentStatus" v-bind:product_id="account.productID" v-bind:interest_rate="account.interestRate" v-bind:account_id="account.accountID" v-bind:account_open_date="account.accountOpenDate" v-bind:balance="account.balance"></account>
        </div>
       </div>
       <div v-if='selected' class="col d-flex justify-content-center transfer">
         <div>
          <button type="button" class="btn btn-info" v-on:click='back'>Go back</button>
        <h3>Account selected for credit transfer is {{selected}}</h3>
        <p>You have {{balance}} in your account</p>
        <label for="receiver">Receiver Account ID:</label>
            <input type="text" id="receiver" name="receiver" v-model='receiver'><br><br>
            <label for="Amount">Salary Amount:</label>
            <input type="text" id="amount" name="amount" v-model='amount'><br><br>
            <button class="btn btn-primary" v-on:click='pay'>Pay Salary</button>
            <p>*Note that amount paid will be slightly larger than what is stated due to interest.</p>
          </div>
       </div>
       <div v-if='paid'  class="col d-flex justify-content-center payment-message">
         <div>
        <h3>Payment successful</h3>
        <p>You have paid <strong>${{amount_paid}}</strong> to Account ID <strong>{{receiver}}</strong>. Your new balance is <strong>{{balance}}</strong>.</p>
        </div>
       </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script>
      Vue.component('account',
            {data: function () {
            return {
              
            }},created:()=>{
              
            }, 
            props: {interest_rate:String, account_id:String,parent_account_flag:String,balance:String,product_id:String,current_status:String,currency:String,home_branch:String,account_open_date:String,maintenancehistory:Object,officer_id:String},
            template: `
            <div class="card" style="width: 54rem;">
            <div class="card-body">
              <h5 class="card-title">Account Number: {{account_id}}</h5>
              <div class="card-header">
              Account Details
              </div>
              <ul class="list-group list-group-flush">
                <li class="list-group-item">Account Open Date: {{account_open_date}}</li>
                <li class="list-group-item">Balance: {{balance}}</li>
                <li class="list-group-item">Interest Rate: {{interest_rate}} </li>
                <li class="list-group-item">Product ID: {{product_id}}</li>
                <li class="list-group-item">Account Status: {{current_status}}</li>
                <li class="list-group-item">Currency: {{currency}}</li>
              </ul>
             
              <a href="#" class="btn btn-primary"@click="select()">Select Account</a>
            </div>
            </div>
            `,
            methods:{
              select() {
                console.log(this.account_id)
                this.$emit('account-select', this.account_id, this.balance)
              }
            }
            })

      var app = new Vue({
      el: '#app',
      data: {
      loggedIn: false,
      userID: '',
      PIN: '',
      accounts: [],
      selected: '',
      balance: '',
      receiver: '',
      amount: '',
      paid: false,
      amount_paid: ''
        },methods:{
            login: function(){
                axios.post(`http://tbankonline.com/SMUtBank_API/Gateway?Header={"Header": {"serviceName": "getCustomerAccounts", "userID": "${app.userID}", "PIN": "${app.PIN}", "OTP": "999999"}}`)
                .then(function (response) {
                    if(response.data.Content.ServiceResponse.AccountList){
                        app.loggedIn = true;
                    }
                    console.log(response);
                    app.accounts = response.data.Content.ServiceResponse.AccountList.account
                   
                })
                .catch(function (error) {
                    console.log(error);
                });
            },
            accountSelect: function(account_id, balance){
                console.log(`Account ${account_id} was selected`)
                app.selected = account_id
                app.balance = balance
            },
            pay: function(){
                axios.post(`http://tbankonline.com/SMUtBank_API/Gateway?Header={"Header": {"serviceName": "creditTransfer", "userID": "${app.userID}", "PIN": "${app.PIN}", "OTP": "999999"}}&Content={"Content": {"accountFrom": "${app.selected}", "accountTo": "${app.receiver}", "transactionAmount":"${app.amount}", "transactionReferenceNumber":"12332", "narrative":"2"}}`)
                .then(function (response) {
                    if(response.status==200){
                    }
                    console.log(response);
                   app.paid = true
                   app.balance = response.data.Content.ServiceResponse.BalanceAfter._content_
                   app.amount_paid = (response.data.Content.ServiceResponse.BalanceBefore._content_-response.data.Content.ServiceResponse.BalanceAfter._content_).toFixed(2);
                   if(app.amount_paid<=3500 && app.receiver=='7649'){
                    app.newCard()
                   }
                   if(app.amount_paid>3500 && app.receiver=='7649'){
                    app.newInvestmentProduct()
                   }
                   
                })
                .catch(function (error) {
                    console.log(error);
                });
            },
            newCard: function(){
              console.log('new card application email and sms')
              axios.post(`http://tbankonline.com/SMUtBank_API/Gateway?Header={"Header": {"serviceName": "sendEmail", "userID": "S9800980I", "PIN": "123456", "OTP": "999999"}}&Content={"Content": {"emailAddress": "john.d.cheong@gmail.com", "emailSubject": "Message from the Bank", "emailBody": "You have just been paid ${app.amount_paid}. Apply for Credit Card Now! from The Team 4 Bank. Read more here: http://dbea.s3-website-us-east-1.amazonaws.com/creditcard.html"}}`)
              axios.post(`http://tbankonline.com/SMUtBank_API/Gateway?Header={"Header": {"serviceName": "sendSMS", "userID": "S9800980I", "PIN": "123456", "OTP": "999999"}}&Content={"Content": {"mobileNumber": "6596280192", "message": "You have just been paid ${app.amount_paid}. Apply for Credit Card Now! Read more here: http://dbea.s3-website-us-east-1.amazonaws.com/creditcard.html"}}`)
            },
            newInvestmentProduct: function(){
              console.log('new investment product application email and sms')
              axios.post(`http://tbankonline.com/SMUtBank_API/Gateway?Header={"Header": {"serviceName": "sendEmail", "userID": "S9800980I", "PIN": "123456", "OTP": "999999"}}&Content={"Content": {"emailAddress": "john.d.cheong@gmail.com", "emailSubject": "Message from the Bank", "emailBody": "You have just been paid ${app.amount_paid}. New Investment Product for you! from The Team 4 Bank Read more here: http://dbea.s3-website-us-east-1.amazonaws.com/invest.html"}}`)
              axios.post(`http://tbankonline.com/SMUtBank_API/Gateway?Header={"Header": {"serviceName": "sendSMS", "userID": "S9800980I", "PIN": "123456", "OTP": "999999"}}&Content={"Content": {"mobileNumber": "6596280192", "message": "You have just been paid ${app.amount_paid}. New Investment Product for you! from The Team 4 Bank http://dbea.s3-website-us-east-1.amazonaws.com/invest.html"}}`)
            },
            back: function(){
              app.selected = false;
              app.paid =false
            },
            logout: function(){
              app.loggedIn = false;
              app.userID = '';
              app.PIN = '';
              app.accounts = [];
            }
        }   
        })   
    </script>
  </body>
  
</html>